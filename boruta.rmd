---
output: word_document
---
```{r}
install.packages("Boruta", repos = "http://cran.us.r-project.org")
library(Boruta)
```

## read the file and remove unnecessary fields
```{r}
houseData <- read.csv("file:///G:/Ryerson-BigData/capstone-R/CKME-136/data/kc_house_data.csv")
houseData$date<-NULL
houseData$id<-NULL
colnames(houseData)
```


# USING BORUTA for features selection and finally making model with the selected attributes
```{r echo=TRUE}
set.seed(1)
boruta.train <- Boruta(price ~., data = houseData , doTrace = 2,ntree = 500)
print(boruta.train)
plot(boruta.train, xlab = "", xaxt = "n")
Boruta.Short <- Boruta(price ~ ., data = houseData, maxRuns = 12)
```

#Start calculating RMSE
```{r echo=TRUE}
newhouseData <- houseData

set.seed(1)
i=0.6
storage <- list(c(), c(), c(),c())
for(i in seq(from=0.6, to=0.9, by=0.01)){
  rn_train <- sample(nrow(newhouseData),floor(nrow(newhouseData)*i))
  train <- newhouseData[rn_train,colnames(newhouseData)]
  test <- newhouseData[-rn_train,colnames(newhouseData)]
  model <- lm(formula = price~.,data=train)
  prediction <- predict(model,interval='prediction',newdata = test)
  train_prediction = fitted(model)
  train_rmse = sqrt(sum((train_prediction-train$price)^2)/nrow(train))
  test_rmse = sqrt(sum((prediction - test$price)^2)/nrow(test))
  storage[[1]]<-c(storage[[1]],i)
  storage[[2]]<-c(storage[[2]],test_rmse)
  storage[[3]]<-c(storage[[3]],train_rmse)
}

##find the LM with minimun training error
RMSE = storage[[3]]
minimumVal = min(RMSE)
minimumVal
indx = which(RMSE==min(RMSE))
indx
storage[[1]][indx]

cat("\nMinimum Training RMSE of Regression:",storage[[3]][indx],"\nRMSE of testing :",storage[[2]][indx], "\nTraining data Percentage:",storage[[1]][indx])

```


## Now we come to a conclusion that 73% Training data provides the Minimum RMSE
## 1: SET training Data = 73% &
## 2: Get model with coeeficient & Intercept
## 3: Draw the error of Histogram to get confidence with model
## 4: Find out how many data have less than 25% of error
```{r}
rn_train <- sample(nrow(newhouseData),floor(nrow(newhouseData)*storage[[1]][indx]))
train <- newhouseData[rn_train,colnames(newhouseData)]
test <- newhouseData[-rn_train,colnames(newhouseData)]
modelXGen <- lm(price~.,data = train)
summary(modelXGen)

predictionXGen <- predict(modelXGen,interval='prediction',newdata = test)
test_rmseXGen = sqrt(sum((predictionXGen - test$price)^2)/nrow(test))
errors <- predictionXGen[,'fit'] - test$price
hist(errors,col=(c("gold","darkgreen")))
rel_change = 1 - ((test$price - abs(errors)) / test$price)
##Now the percentage of cases with less than 25% error.
pred25 = table(rel_change<0.25)["TRUE"] / nrow(test)
pred25
cat("\nConclusion:percent of data having less than 25% error:",pred25)

```