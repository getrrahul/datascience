---
output: word_document
---

```{r echo=TRUE}
checkNaFunction <- function(HousePrice){
naColumns <- c()
#checking NA for each columns
for(i in 1:ncol(HousePrice)) {
  #cat(sprintf("Checking NA: %s \n", colnames(HousePrice)[i]))
  if(length(which(is.na(HousePrice[,i]))) > 0){
    #cat(sprintf("There is NA: %s \n" , colnames(HousePrice)[i]))
    naColumns <- c(naColumns, colnames(HousePrice)[i])
  }
}
return(naColumns)
}

```


```{r echo=TRUE}
analysis <- function(HousePrice, i, labels){
  plot(HousePrice$price~HousePrice[,i],main = labels[1],xlab = labels[2],ylab = labels[3],col.main='Blue',col.axis='Gray',col.lab = 'Gray',col = 'Gray')
  
  hist(HousePrice[,i],main = labels[1],xlab = labels[2],ylab = labels[3],col.main='Blue',col.axis='Gray',col.lab = 'Gray',col = 'Gray')

  boxplot(HousePrice[,i],main = labels[1],col.main='Blue',col.axis='Gray',col.lab = 'Gray',col = 'Gray')
  
  cor(HousePrice[,i],HousePrice$price)
}

```


#Data Importing And Cleaning
```{r echo=TRUE}
HousePrice <- read.csv("file:///G:/Ryerson-BigData/capstone-R/CKME-136/data/kc_house_data.csv")
head(HousePrice)
colnames(HousePrice)
naColumns <- checkNaFunction(HousePrice)
if(length(naColumns)>0){
  cat("Found NA Colums:")
  for(i in 1:length(naColumns)) {
    cat(sprintf("%s,", colnames(HousePrice)[i]))
  }
}
# Here we conclude that this data does not hold any column with NA.

```

#BEDROOM ANALYSIS
```{r echo=TRUE}
analysis(HousePrice,4,c('Bedrooms-HousePrice','Bedrooms', 'No of Houses'))
#*******Removing the outliers
#Since more than 7 bedrooms are very rare.Also it's the outlier for my model.
#I  have removed  the outlier data.
HousePrice<-subset(HousePrice,bedrooms>=1 & bedrooms<=7)
#*******Once we removed the outliers, again get the analysis
analysis(HousePrice,4,c('Bedrooms-HousePrice','Bedrooms', 'No of Houses'))
```


#BATHROOM ANALYSIS
```{r echo=TRUE}
analysis(HousePrice,5,c('Bathrooms-HousePrice','Bathrooms', 'No of Houses'))
#*******Removing the outliers
#More than 4 bathrooms are very rare in this data.So I am removing it.
HousePrice<-subset(HousePrice,bathrooms>=1 & bathrooms<=4)
analysis(HousePrice,5,c('Bathrooms-HousePrice','Bathrooms', 'No of Houses'))
```


#SQFT LIVING ANALYSIS
```{r echo=TRUE}
analysis(HousePrice,6,c('Living-Sqft-HousePrice','Living-Sqft', 'No of Houses'))
#*******Removing the outliers
HousePrice<-subset(HousePrice,sqft_living >1000 & sqft_living<=4000)
analysis(HousePrice,6,c('Living-Sqft-HousePrice','Living-Sqft', 'No of Houses'))

```

##GRADE ANALYSIS
```{r echo=TRUE}
analysis(HousePrice,12,c('Grade-HousePrice','Grade', 'No of Houses'))
#*******Removing the outliers
#Most of the houses grades are between 6-10 
HousePrice<-subset(HousePrice,grade >= 6 & grade<=10)
analysis(HousePrice,12,c('Grade-HousePrice','Grade', 'No of Houses'))

```

#SQFT_ABOVE ANALYSIS
```{r echo=TRUE}
analysis(HousePrice,13,c('MainHouseSize-HousePrice','MainHouseSize', 'No of Houses'))
#*******Removing the outliers
HousePrice<-subset(HousePrice,sqft_above >=500 & sqft_above<=3500)
analysis(HousePrice,13,c('MainHouseSize-HousePrice','MainHouseSize', 'No of Houses'))

```

#YR_BUILT ANALYSIS
```{r echo=TRUE}
analysis(HousePrice,15,c('YearBuilt-HousePrice','YearBuilt', 'No of Houses'))
#*******Removing the outliers
#In our data some records are too old..I just removed that data from my model.
#Because It doesn't make any sense to keep more than 100 years house in our model
HousePrice<-subset(HousePrice,yr_built>=1950& yr_built<=2015)
analysis(HousePrice,15,c('YearBuilt-HousePrice','YearBuilt', 'No of Houses'))
```


#ZIPCODE ANALYSIS
```{r echo=TRUE}
analysis(HousePrice,17,c('ZipCode-HousePrice','ZipCode', 'No of Houses'))
```


##CONDITION aNALYSIS
```{r echo=TRUE}
analysis(HousePrice,11,c('Condition-HousePrice','condition', 'No of Houses'))
#*******Removing the outliers
HousePrice<-subset(HousePrice,condition>=3& condition<=5)
analysis(HousePrice,11,c('Condition-HousePrice','condition', 'No of Houses'))
```


##SQFT_BASEMENT ANALYSIS
```{r echo=TRUE}
analysis(HousePrice,14,c('BasementSize-HousePrice','BasementSize', 'No of Houses'))
#*******Removing the outliers
HousePrice<-subset(HousePrice,sqft_basement >=0 & sqft_basement<=1500)
analysis(HousePrice,14,c('BasementSize-HousePrice','BasementSize', 'No of Houses'))
```

##LAT ANALYSIS
```{r echo=TRUE}
analysis(HousePrice,18,c('Latitude-HousePrice','latitude', 'No of Houses'))
#*******Removing the outliers
HousePrice<-subset(HousePrice,lat>=47.3)
analysis(HousePrice,18,c('Latitude-HousePrice','latitude', 'No of Houses'))
```

## LONG ANALYSIS
```{r echo=TRUE}
analysis(HousePrice,19,c('Longitude-HousePrice','Longitude', 'No of Houses'))
#*******Removing the outliers
HousePrice<-subset(HousePrice,long>=-122.4 & long < -121.8)
analysis(HousePrice,19,c('Longitude-HousePrice','Longitude', 'No of Houses'))
```


## SQFT_LOT ANALYSIS
```{r echo=TRUE}
analysis(HousePrice,7,c('LotSize-HousePrice','LotSize', 'No of Houses'))
#*******Removing the outliers
HousePrice<-subset(HousePrice,sqft_lot>=0 & sqft_lot<=25000)
analysis(HousePrice,7,c('LotSize-HousePrice','LotSize', 'No of Houses'))
```

## FLOOR ANALYSIS
```{r echo=TRUE}
analysis(HousePrice,8,c('Floors-HousePrice','Floor', 'No of Houses'))
```

## SQFT_LIVING15 ANALYSIS
```{r echo=TRUE}
analysis(HousePrice,20,c('sqft_living15-HousePrice','sqft_living15', 'No of Houses'))

```

##SQFT_LOT15 ANALYSIS
```{r echo=TRUE}
analysis(HousePrice,21,c('sqft_lot15-HousePrice','sqft_lot15', 'No of Houses'))
#*******Removing the outliers
HousePrice<-subset(HousePrice,sqft_lot15>=0 & sqft_lot<=20000)
analysis(HousePrice,21,c('sqft_lot15-HousePrice','sqft_lot15', 'No of Houses'))

```

##Correlation among all the variables
```{r echo=TRUE}
#*******Only sqft_living & sqft_above,sqft_living & grade,sqft_living & bathrooms have good correlation between them
HousePrice$date <- NULL
cor(HousePrice)

```
# Linear Model using stepAIC method
```{r echo=TRUE}
lm <- lm(formula = price~.,data=HousePrice)
install.packages("MASS", repos = "http://cran.us.r-project.org")
library(MASS)
stepb<-stepAIC(lm,direction="backward",trace=TRUE)
summary(stepb)
```
```{r echo=TRUE}
#since floor is having very less contribution to price.we are not including floor in our model.
str(HousePrice)
sapply(HousePrice, is.numeric)
HousePrices <- HousePrice[ , sapply(HousePrice, is.numeric)]
cor(HousePrices)
```


```{r echo=TRUE}
#since no any variable is highly correlated with each other
HousePrice$floors<-NULL
HousePrice$date<-NULL
str(HousePrice)

colnames(HousePrice)
set.seed(1)
for(i in seq(from=0.6, to=0.9, by=0.05)){
  rn_train <- sample(nrow(HousePrice),floor(nrow(HousePrice)*i))
  train <- HousePrice[rn_train,colnames(HousePrice)]
  test <- HousePrice[-rn_train,colnames(HousePrice)]
  lm.price<-lm(price~.,data = train)
  prediction <- predict(lm.price,newdata = test)
  training_data_prediction = fitted(lm.price)
  training_rmse = sqrt(sum((training_data_prediction-train$price)^2)/nrow(train))
  testing_rmse = sqrt(sum((prediction - test$price)^2)/nrow(test))
  cat("\ntraining_rmse:",training_rmse)
  cat("\ntesting_rmse:",testing_rmse)
  print(lm.price)
}

```

